---
/* Header responsive con selector de carrera + acciones a la derecha + menú hamburguesa */
---
<header class="relative bg-white px-4 py-6 ">
  <!-- Fila principal -->
  <div class="flex items-center gap-3">
    <!-- Columna izquierda: Selector -->
    <div class="flex-1 min-w-0">
      <label for="careerSelect" class="block text-sm font-semibold text-gray-700">
        CARRERA DE
      </label>
      <select
        id="careerSelect"
        class="w-full max-w-[420px] truncate text-xl sm:text-2xl font-bold text-gray-900 cursor-pointer bg-transparent focus:outline-none"
        aria-label="Seleccionar carrera"
      >
        <option value="INF">INGENIERIA CIVIL INFORMATICA</option>
        <option value="TO">TERAPIA OCUPACIONAL</option>
      </select>
    </div>

    

    <!-- Botón hamburguesa (solo móvil) -->
    <button
      id="menu-toggle"
      class="md:hidden ml-auto inline-flex items-center justify-center rounded-md p-2 text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      aria-label="Abrir menú"
      aria-controls="actions"
      aria-expanded="false"
      type="button"
    >
      <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor"
           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <!-- Columna derecha (acciones) en escritorio -->
    <div class="hidden md:flex md:flex-1 md:justify-end md:items-center md:gap-2">
      <!-- Inputs ocultos -->
      <input type="file" id="jsonFileInput" accept=".json" class="hidden" />
      <input type="file" id="progressInput" accept=".json" class="hidden" />

      <!-- Botones (mismo tamaño, mismo estilo) -->
      <button id="loadJsonBtn"
        class="inline-flex items-center justify-center gap-2 whitespace-nowrap bg-[#8361FE] text-white px-4 h-12 min-w-[4rem] max-w-[10rem] rounded-xl font-medium text-sm shadow-md hover:bg-[#6f4ae0] hover:shadow-lg transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#8361FE]/50 hover:-translate-y-0.5 active:translate-y-0">
        <span aria-hidden>📂</span><span>Cargar Malla</span>
      </button>

      <button id="importProgressBtn"
        class="inline-flex items-center justify-center gap-2 whitespace-nowrap bg-[#8361FE] text-white px-4 h-12 min-w-[4rem] max-w-[10rem] rounded-xl font-medium text-sm shadow-md hover:bg-[#6f4ae0] hover:shadow-lg transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#8361FE]/50 hover:-translate-y-0.5 active:translate-y-0">
        <span aria-hidden>⬆️</span><span>Importar Progreso</span>
      </button>

      <button id="exportProgressBtn"
        class="inline-flex items-center justify-center gap-2 whitespace-nowrap bg-[#8361FE] text-white px-4 h-12 min-w-[4rem] max-w-[10rem] rounded-xl font-medium text-sm shadow-md hover:bg-[#6f4ae0] hover:shadow-lg transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#8361FE]/50 hover:-translate-y-0.5 active:translate-y-0">
        <span aria-hidden>⬇️</span><span>Exportar Progreso</span>
      </button>

      <button id="resetBtn"
        class="inline-flex items-center justify-center gap-2 whitespace-nowrap bg-[#8361FE] text-white px-4 h-12 min-w-[4rem] max-w-[10rem] rounded-xl font-medium text-sm shadow-md hover:bg-[#6f4ae0] hover:shadow-lg transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#8361FE]/50 hover:-translate-y-0.5 active:translate-y-0">
        <span aria-hidden>♻️</span><span>Reiniciar</span>
      </button>
    </div>
  </div>

  <!-- Menú móvil desplegable (mismo set de acciones) -->
  <div
    id="actions"
    class="md:hidden absolute left-0 right-0 top-full z-40 bg-white border-t shadow-md hidden"
  >
    <div class="p-4 space-y-4">
      <!-- (Opcional) título visible en móvil -->
      <p class="md:hidden text-xl font-semibold text-gray-700 text-center">Malla Interactiva</p>

      <!-- Inputs ocultos -->
      <input type="file" id="jsonFileInput" accept=".json" class="hidden" />
      <input type="file" id="progressInput" accept=".json" class="hidden" />

      <!-- Acciones en stack -->
      <div class="grid grid-cols-1 gap-2">
        <button id="loadJsonBtn" class="w-full bg-[#8361FE] text-white px-4 py-2 font-semibold text-sm rounded-lg hover:bg-[#654BC4]">
          Cargar Malla
        </button>
        <button id="importProgressBtn" class="w-full bg-[#8361FE] text-white px-4 py-2 font-semibold text-sm rounded-lg hover:bg-[#654BC4]">
          Importar Progreso
        </button>
        <button id="exportProgressBtn" class="w-full bg-[#8361FE] text-white px-4 py-2 font-semibold text-sm rounded-lg hover:bg-[#654BC4]">
          Exportar Progreso
        </button>
        <button id="resetBtn" class="w-full bg-[#8361FE] text-white px-4 py-2 font-semibold text-sm rounded-lg hover:bg-[#654BC4]">
          Reiniciar
        </button>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  // ---------- Hamburguesa (toggle del menú móvil) ----------
  const toggleBtn = document.getElementById('menu-toggle');
  const actions = document.getElementById('actions');

  toggleBtn?.addEventListener('click', () => {
    const isHidden = actions.classList.contains('hidden');
    actions.classList.toggle('hidden', !isHidden);
    toggleBtn.setAttribute('aria-expanded', String(isHidden));
  });

  // Cierra el menú si se hace click fuera (en móvil)
  document.addEventListener('click', (e) => {
    if (!actions || !toggleBtn) return;
    const clickInsideMenu = actions.contains(e.target);
    const clickOnButton = toggleBtn.contains(e.target);
    if (!clickInsideMenu && !clickOnButton && !actions.classList.contains('hidden')) {
      actions.classList.add('hidden');
      toggleBtn.setAttribute('aria-expanded', 'false');
    }
  });

  // Cierra el menú cuando se cambia el tamaño a md+
  window.addEventListener('resize', () => {
    if (window.matchMedia('(min-width: 768px)').matches) {
      actions?.classList.add('hidden');
      toggleBtn?.setAttribute('aria-expanded', 'false');
    }
  });

  // ---------- Selector de carrera (default + remember) ----------
  const careerSelect = document.getElementById('careerSelect');
  const LS_KEY = 'malla-career';

  // Cargar última carrera elegida o INF por defecto
  const saved = localStorage.getItem(LS_KEY);
  if (saved && [...careerSelect.options].some(o => o.value === saved)) {
    careerSelect.value = saved;
  } else {
    careerSelect.value = 'INF';
  }

  // Disparar carga inicial
  window.addEventListener('DOMContentLoaded', () => {
    const code = careerSelect.value || 'INF';
    window.dispatchEvent(new CustomEvent('careerChange', { detail: { code } }));
  });

  // Disparar en cada cambio y guardar preferencia
  careerSelect?.addEventListener('change', () => {
    const code = careerSelect.value;
    localStorage.setItem(LS_KEY, code);
    window.dispatchEvent(new CustomEvent('careerChange', { detail: { code } }));
  });
</script>
